name: Builder
on:
  schedule:
    - cron: "0 5 * * *"
  workflow_dispatch:
jobs:

  builder:
    strategy:
      matrix:
        build: [linux-xanmod, linux-xanmod-custom,linux-xanmod-edge,linux-xanmod-lts,linux-xanmod-tt, packettracer, slimjet, spotify-adblock-git, cloudflared,microsoft-edge-dev-bin,microsoft-edge-beta-bin, xampp, spotify, yay]
      fail-fast: false
    runs-on: ubuntu-latest
    steps:
      - name: Build packages for arch
        uses: actions/checkout@v2.3.5
        with:
          submodules: true
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
      - name : update submodule
        run: git submodule update --recursive --remote
      - name: Configure GPG Key
        run: |
          echo -n "$GPG_SIGNING_KEY" | base64 --decode | gpg --import
        env:
          GPG_SIGNING_KEY: ${{ secrets.GPG }}
      - id: makepkg
        uses: JPratama7/pkgbuild-action@jemalloc
        with:
          pkgdir: ${{ matrix.build }}
          makepkgArgs: "--skippgpcheck"
      - run: |
          cd ${{ matrix.build }}
          gpg --detach-sign *.zst
      - uses: ncipollo/release-action@v1.8.10
        with:
          allowUpdates: true
          replacesArtifacts: true
          tag: "latest"
          artifacts: "*/*.zst, */*.sig"
          token: ${{ secrets.GITHUB_TOKEN }}


  # build_xanmod_stable:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Build linux-xanmod-custom for arch
  #       uses: actions/checkout@v2.3.5
  #     - id: makepkg
  #       uses: JPratama7/pkgbuild-action@master
  #       with:
  #         makepkgArgs: "--skippgpcheck"
  #         pkgdir: "linux-xanmod"

  #     - uses: ncipollo/release-action@v1.8.10
  #       with:
  #         allowUpdates: true
  #         replacesArtifacts: true
  #         tag: "latest"
  #         artifacts: "*/*.zst"
  #         token: ${{ secrets.GITHUB_TOKEN }}

  # build_xanmod_custom:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Build linux-xanmod-custom for arch
  #       uses: actions/checkout@v2.3.5
  #     - id: makepkg
  #       uses: JPratama7/pkgbuild-action@master
  #       with:
  #         makepkgArgs: "--skippgpcheck"
  #         pkgdir: "linux-xanmod-custom"

  #     - uses: ncipollo/release-action@v1.8.10
  #       with:
  #         allowUpdates: true
  #         replacesArtifacts: true
  #         tag: "latest"
  #         artifacts: "*/*.zst"
  #         token: ${{ secrets.GITHUB_TOKEN }}

  # build_xanmod_lts:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Build linux-xanmod-custom for arch
  #       uses: actions/checkout@v2.3.5
  #     - id: makepkg
  #       uses: JPratama7/pkgbuild-action@master
  #       with:
  #         makepkgArgs: "--skippgpcheck"
  #         pkgdir: "linux-xanmod-lts"

  #     - uses: ncipollo/release-action@v1.8.10
  #       with:
  #         allowUpdates: true
  #         replacesArtifacts: true
  #         tag: "latest"
  #         artifacts: "*/*.zst"
  #         token: ${{ secrets.GITHUB_TOKEN }}

  # build_xanmod_edge:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Build linux-xanmod-custom for arch
  #       uses: actions/checkout@v2.3.5
  #     - id: makepkg
  #       uses: JPratama7/pkgbuild-action@master
  #       with:
  #         makepkgArgs: "--skippgpcheck"
  #         pkgdir: "linux-xanmod-edge"

  #     - uses: ncipollo/release-action@v1.8.10
  #       with:
  #         allowUpdates: true
  #         replacesArtifacts: true
  #         tag: "latest"
  #         artifacts: "*/*.zst"
  #         token: ${{ secrets.GITHUB_TOKEN }}

  # build_xanmod_tt:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: build linux-xanmod-cacule
  #       uses: actions/checkout@v2.3.5
  #     - id: makepkg
  #       uses: JPratama7/pkgbuild-action@master
  #       with:
  #         makepkgArgs: "--skippgpcheck"
  #         pkgdir: "linux-xanmod-tt"

  #     - uses: ncipollo/release-action@v1.8.10
  #       with:
  #         allowUpdates: true
  #         replacesArtifacts: true
  #         tag: "latest"
  #         artifacts: "*/*.zst"
  #         token: ${{ secrets.GITHUB_TOKEN }}

  # build_spotify_adblock_git:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: build spotify-adblock-git for arch
  #       uses: actions/checkout@v2.3.4
  #       with:
  #         submodules: true
  #         fetch-depth: 0
  #         token: ${{ secrets.GITHUB_TOKEN }}
  #     - run: git submodule update --recursive --remote
  #     - id: makepkg
  #       uses: JPratama7/pkgbuild-action@master
  #       with:
  #         makepkgArgs: "--skippgpcheck"
  #         pkgdir: "spotify-adblock-git"
  #     - run: ls -lR
  #     - uses: ncipollo/release-action@v1.8.10
  #       with:
  #         allowUpdates: true
  #         replacesArtifacts: true
  #         tag: "latest"
  #         artifacts: "*/*.zst"
  #         token: ${{ secrets.GITHUB_TOKEN }}

  # build_slimjet:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: build slimjet for arch
  #       uses: actions/checkout@v2.3.4
  #       with:
  #         submodules: true
  #         fetch-depth: 0
  #         token: ${{ secrets.GITHUB_TOKEN }}
  #     - run: git submodule update --recursive --remote
  #     - id: makepkg
  #       uses: JPratama7/pkgbuild-action@master
  #       with:
  #         makepkgArgs: "--skippgpcheck"
  #         pkgdir: "slimjet"
  #     - run: ls -lR
  #     - uses: ncipollo/release-action@v1.8.10
  #       with:
  #         allowUpdates: true
  #         replacesArtifacts: true
  #         tag: "latest"
  #         artifacts: "*/*.zst"
  #         token: ${{ secrets.GITHUB_TOKEN }}

  # build_spotify:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: build slimjet for arch
  #       uses: actions/checkout@v2.3.4
  #       with:
  #         submodules: true
  #         fetch-depth: 0
  #         token: ${{ secrets.GITHUB_TOKEN }}
  #     - run: git submodule update --recursive --remote
  #     - id: makepkg
  #       uses: JPratama7/pkgbuild-action@master
  #       with:
  #         makepkgArgs: "--skippgpcheck"
  #         pkgdir: "spotify"
  #     - run: ls -lR
  #     - uses: ncipollo/release-action@v1.8.10
  #       with:
  #         allowUpdates: true
  #         replacesArtifacts: true
  #         tag: "latest"
  #         artifacts: "*/*.zst"
  #         token: ${{ secrets.GITHUB_TOKEN }}

  # build_cloudflared:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: build slimjet for arch
  #       uses: actions/checkout@v2.3.4
  #       with:
  #         submodules: true
  #         fetch-depth: 0
  #         token: ${{ secrets.GITHUB_TOKEN }}
  #     - run: git submodule update --recursive --remote
  #     - id: makepkg
  #       uses: JPratama7/pkgbuild-action@master
  #       with:
  #         makepkgArgs: "--skippgpcheck"
  #         pkgdir: "cloudflared"
  #     - run: ls -lR
  #     - uses: ncipollo/release-action@v1.8.10
  #       with:
  #         allowUpdates: true
  #         replacesArtifacts: true        
  #         tag: "latest"
  #         artifacts: "*/*.zst"
  #         token: ${{ secrets.GITHUB_TOKEN }}
          
  # build_xampp:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: build slimjet for arch
  #       uses: actions/checkout@v2.3.4
  #       with:
  #         submodules: true
  #         fetch-depth: 0
  #         token: ${{ secrets.GITHUB_TOKEN }}
  #     - run: git submodule update --recursive --remote
  #     - run: ls -lR
  #     - id: makepkg
  #       uses: JPratama7/pkgbuild-action@master
  #       with:
  #         makepkgArgs: "--skippgpcheck"
  #         pkgdir: 'xampp'
  #     - run: ls -lR
  #     - uses: ncipollo/release-action@v1.8.10
  #       with:
  #         allowUpdates: true
  #         replacesArtifacts: true         
  #         tag: "latest"
  #         artifacts: "*/*.zst"
  #         token: ${{ secrets.GITHUB_TOKEN }}
  
  # build_microsoft-edge-beta-bin:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: build slimjet for arch
  #       uses: actions/checkout@v2.3.4
  #       with:
  #         submodules: true
  #         fetch-depth: 0
  #         token: ${{ secrets.GITHUB_TOKEN }}
  #     - run: git submodule update --recursive --remote
  #     - run: ls -lR
  #     - id: makepkg
  #       uses: JPratama7/pkgbuild-action@master
  #       with:
  #         makepkgArgs: "--skippgpcheck"          
  #         pkgdir: 'microsoft-edge-dev-bin'
  #     - run: ls -lR
  #     - uses: ncipollo/release-action@v1.8.10
  #       with:
  #         allowUpdates: true
  #         replacesArtifacts: true          
  #         tag: "latest"
  #         artifacts: "*/*.zst"
  #         token: ${{ secrets.GITHUB_TOKEN }}

  # build_microsoft-edge-dev-bin:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: build slimjet for arch
  #       uses: actions/checkout@v2.3.4
  #       with:
  #         submodules: true
  #         fetch-depth: 0
  #         token: ${{ secrets.GITHUB_TOKEN }}
  #     - run: git submodule update --recursive --remote
  #     - run: ls -lR
  #     - id: makepkg
  #       uses: JPratama7/pkgbuild-action@master
  #       with:
  #         makepkgArgs: "--skippgpcheck"   
  #         pkgdir: 'microsoft-edge-beta-bin'
  #     - run: ls -lR
  #     - uses: ncipollo/release-action@v1.8.10
  #       with:
  #         allowUpdates: true
  #         replacesArtifacts: true         
  #         tag: "latest"
  #         artifacts: "*/*.zst"
  #         token: ${{ secrets.GITHUB_TOKEN }}

  # build_packet_tracer_cisco:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: build slimjet for arch
  #       uses: actions/checkout@v2.3.4
  #       with:
  #         submodules: true
  #         fetch-depth: 0
  #         token: ${{ secrets.GITHUB_TOKEN }}
  #     - run: git submodule update --recursive --remote
  #     - run: ls -lR
  #     - id: makepkg
  #       uses: JPratama7/pkgbuild-action@master
  #       with:
  #         makepkgArgs: "--skippgpcheck"
  #         pkgdir: 'packettracer'
  #     - run: ls -lR
  #     - uses: ncipollo/release-action@v1.8.10
  #       with:
  #         allowUpdates: true
  #         replacesArtifacts: true
  #         tag: "latest"
  #         artifacts: "*/*.zst"
  #         token: ${{ secrets.GITHUB_TOKEN }}

  # build_github_desktop:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: build slimjet for arch
  #       uses: actions/checkout@v2.3.4
  #       with:
  #         submodules: true
  #         fetch-depth: 0
  #         token: ${{ secrets.GITHUB_TOKEN }}
  #     - run: git submodule update --recursive --remote
  #     - run: ls -lR
  #     - id: makepkg
  #       uses: JPratama7/pkgbuild-action@master
  #       with:
  #         makepkgArgs: "--skippgpcheck"
  #         pkgdir: 'github-desktop'
  #     - run: ls -lR
  #     - uses: ncipollo/release-action@v1.8.10
  #       with:
  #         allowUpdates: true
  #         replacesArtifacts: true
  #         tag: "latest"
  #         artifacts: "*/*.zst"
  #         token: ${{ secrets.GITHUB_TOKEN }}
